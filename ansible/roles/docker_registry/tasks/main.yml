---
- name: Create Docker Registry data directory
  ansible.builtin.file:
    path: "{{ docker_registry_data_dir }}"
    state: directory
    mode: "0755"

# -- Quadlet container file --
- name: Deploy Docker Registry quadlet container file
  ansible.builtin.template:
    src: docker-registry.container.j2
    dest: /etc/containers/systemd/docker-registry.container
    mode: "0644"
  notify:
    - Daemon reload registry
    - Restart docker-registry

# -- Reload and start --
- name: Reload systemd daemon for quadlet
  ansible.builtin.systemd:
    daemon_reload: true

- name: Enable and start Docker Registry container
  ansible.builtin.systemd:
    name: docker-registry
    enabled: true
    state: started
